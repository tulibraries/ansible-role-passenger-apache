---

- name: Make sure passenger prerequisites are installed
  yum:
    name: "{{ item }}"
    state: installed
  with_items:
    - epel-release
    - pygpgme
  become: yes
  tags:
    - passenger

- name: Import the passenger gpg key
  rpm_key:
    key: "{{ item }}"
    state: present
  with_items: "{{passenger_yum_repo_gpg_urls}}"
  register: import_key
  become: yes
  tags:
    - passenger

- name: Download the phusion-passenger yum repository
  get_url:
    url: "{{passenger_yum_repo_download_url}}"
    dest: "{{passenger_yum_repos_path}}"
  become: yes
  tags:
    - passenger


- name: Make cache
  command: "yum -q makecache -y --disablerepo='*' --enablerepo='passenger'"
  when: import_key.changed
  become: yes

- name: Install the passenger repository
  yum:
    name: mod_passenger
    state: installed
    update_cache: yes
  become: yes
  notify: restart apache
  tags:
    - passenger
