---
- name: Install Apache HTTPD
  package:
    name: httpd
    state: present
  become: true

- name: Update certificates
  yum:
    name: ca-certificates
    update_cache: true
    state: latest
  become: true

- name: Make sure Passenger prerequisites are installed
  dnf:
    name: ["epel-release"]
    state: installed
  become: true
  tags:
    - passenger

- name: Add Passenger repository config
  template:
    src: "{{ passenger_yum_repo_template }}"
    dest: "{{ passenger_yum_repos_path }}"
  become: true
  tags:
    - passenger

- name: Install the Passenger repository
  yum:
    name: "{{ passenger_package_name }}"
    state: installed
    update_cache: true
  become: true
  when: lookup("env", "CI_ENV") | default("rocky") != "circleci"
  notify: restart apache
  tags:
    - passenger

